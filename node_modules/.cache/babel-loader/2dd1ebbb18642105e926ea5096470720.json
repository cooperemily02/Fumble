{"ast":null,"code":"'use strict';\n\nconst MongoError = require('../core').MongoError;\n\nconst OperationBase = require('./operation').OperationBase;\n\nconst insertDocuments = require('./common_functions').insertDocuments;\n\nclass InsertOneOperation extends OperationBase {\n  constructor(collection, doc, options) {\n    super(options);\n    this.collection = collection;\n    this.doc = doc;\n  }\n\n  execute(callback) {\n    const coll = this.collection;\n    const doc = this.doc;\n    const options = this.options;\n\n    if (Array.isArray(doc)) {\n      return callback(MongoError.create({\n        message: 'doc parameter must be an object',\n        driver: true\n      }));\n    }\n\n    insertDocuments(coll, [doc], options, (err, r) => {\n      if (callback == null) return;\n      if (err && callback) return callback(err); // Workaround for pre 2.6 servers\n\n      if (r == null) return callback(null, {\n        result: {\n          ok: 1\n        }\n      }); // Add values to top level to ensure crud spec compatibility\n\n      r.insertedCount = r.result.n;\n      r.insertedId = doc._id;\n      if (callback) callback(null, r);\n    });\n  }\n\n}\n\nmodule.exports = InsertOneOperation;","map":null,"metadata":{},"sourceType":"script"}